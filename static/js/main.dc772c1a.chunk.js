(this.webpackJsonpsnake=this.webpackJsonpsnake||[]).push([[0],{128:function(e,t,n){},129:function(e,t,n){},130:function(e,t,n){"use strict";n.r(t);var i,o=n(0),r=n.n(o),s=n(30),a=n.n(s),u=(n(67),n(13)),c=n.n(u),h=n(27),l=h.c,d=n(32),f=n.n(d),k=n(23),v=n(31),p=n(60),b=n(11),g=n(14);!function(e){e.Up="Up",e.Right="Right",e.Down="Down",e.Left="Left"}(i||(i={}));var w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[i.Up],n=arguments.length>1?arguments[1]:void 0;Object(b.a)(this,e),this.body=void 0,this.nextDirection=void 0,this.body=t,this.nextDirection=n||this.headDirection}return Object(g.a)(e,[{key:"headDirection",get:function(){return c()(this.body).first()}},{key:"last",get:function(){return c()(this.body).last()}},{key:"length",get:function(){return this.body.length}},{key:"isVertical",get:function(){return this.headDirection===i.Up||this.headDirection===i.Down}},{key:"isHorizontal",get:function(){return this.headDirection===i.Left||this.headDirection===i.Right}},{key:"up",value:function(){return this.isVertical&&this.length>1?this:this.turnSnake(i.Up)}},{key:"right",value:function(){return this.isHorizontal&&this.length>1?this:this.turnSnake(i.Right)}},{key:"down",value:function(){return this.isVertical&&this.length>1?this:this.turnSnake(i.Down)}},{key:"left",value:function(){return this.isHorizontal&&this.length>1?this:this.turnSnake(i.Left)}},{key:"grow",value:function(){return new e(c()(this.body).append(this.last).toArray())}},{key:"move",value:function(){var t=this.turnHead();return new e(this.makeStep(t).toArray())}},{key:"turnHead",value:function(){return c()(this.body).skip(1).prepend(this.nextDirection)}},{key:"makeStep",value:function(e){return e.skipLast(1).prepend(this.nextDirection)}},{key:"turnSnake",value:function(t){return new e(this.body,t)}}]),e}(),y=n(33),j=n(44),O=n(61),m=function(e){Object(y.a)(n,e);var t=Object(j.a)(n);function n(e){return Object(b.a)(this,n),t.call(this,e)}return n}(Object(O.a)(Error)),x=n(35),C=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"compare",value:function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:e[1]-t[1]}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"getHashCode",value:function(e){return(e[0]+1024)*(e[1]+512)}}]),e}(),D=function(){function e(t,n,i){var o,r,s;Object(b.a)(this,e),this.height=void 0,this.width=void 0,this.snake=void 0,this.snakeCells=void 0,this.foodCells=void 0,this.snakePosition=void 0,this.rnd=new x.Random,this.height=t,this.width=n,this.snake=null!==(o=null===i||void 0===i?void 0:i.snake)&&void 0!==o?o:new w,this.snakePosition=null!==(r=null===i||void 0===i?void 0:i.snakePosition)&&void 0!==r?r:[t/2|0,n/2|0],this.snakeCells=this.getSnakeCells(),this.foodCells=(null===i||void 0===i||null===(s=i.foodCells)||void 0===s?void 0:s.length)?i.foodCells:[this.generateRandomFreeCell()]}return Object(g.a)(e,[{key:"snakeNextDirection",get:function(){return this.snake.nextDirection}},{key:"snakeTail",get:function(){return c()(this.snakeCells).last()}},{key:"tick",value:function(){var t=this.getNextSnakePosition();if(!this.checkBounds(t))throw new m("You break area beyond");if(this.isSnakeCell(t)&&!(new C).equals(t,this.snakeTail))throw new m("You did eat yourself");var n=this.snake;return n=n.move(),this.isFoodCell(t)&&(n=n.grow(),this.foodCells=c()(this.foodCells).where((function(e){return!(new C).equals(t,e)})).toArray()),new e(this.height,this.width,{snake:n,snakePosition:t,foodCells:this.foodCells})}},{key:"turnUp",value:function(){return new e(this.height,this.width,{snake:this.snake.up(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnRight",value:function(){return new e(this.height,this.width,{snake:this.snake.right(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnDown",value:function(){return new e(this.height,this.width,{snake:this.snake.down(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnLeft",value:function(){return new e(this.height,this.width,{snake:this.snake.left(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"isSnakeCell",value:function(e){return c()(this.snakeCells).contains(e,new C)}},{key:"isFoodCell",value:function(e){return c()(this.foodCells).contains(e,new C)}},{key:"generateRandomFreeCell",value:function(){var e=null;do{e=[this.rnd.next(this.width),this.rnd.next(this.height)]}while(this.isSnakeCell(e));return e}},{key:"checkBounds",value:function(e){var t=Object(p.a)(e,2),n=t[0],i=t[1];return!(n<0||n>=this.width)&&!(i<0||i>=this.height)}},{key:"getNextSnakePosition",value:function(){var e=this.snakePosition;switch(this.snakeNextDirection){case i.Up:return[e[0],e[1]-1];case i.Right:return[e[0]+1,e[1]];case i.Down:return[e[0],e[1]+1];case i.Left:return[e[0]-1,e[1]]}}},{key:"getSnakeCells",value:function(){for(var e=[this.snakePosition],t=this.snakePosition,n=1;n<this.snake.body.length;n++)t=this.getNextSectionCoord(t,this.snake.body[n]),e.push(t);return e}},{key:"getNextSectionCoord",value:function(e,t){switch(t){case i.Up:return[e[0],e[1]+1];case i.Right:return[e[0]-1,e[1]];case i.Down:return[e[0],e[1]-1];case i.Left:return[e[0]+1,e[1]]}}}]),e}(),S={area:new D(31,31)},M=Object(k.b)({name:"field",initialState:S,reducers:{turnUp:function(e){e.area=e.area.turnUp()},turnRight:function(e){e.area=e.area.turnRight()},turnDown:function(e){e.area=e.area.turnDown()},turnLeft:function(e){e.area=e.area.turnLeft()},tickField:function(e){e.area=e.area.tick()},initField:function(e){e.area=new D(31,31)}}}),P=M.actions,U=P.turnUp,R=P.turnRight,L=P.turnDown,N=P.turnLeft,$=P.tickField,_=P.initField,A=function(e){return e.field.area},F=Object(v.a)(A,(function(e){return function(t){return e.isSnakeCell(t)}})),I=Object(v.a)(A,(function(e){return function(t){return e.isFoodCell(t)}})),H=M.reducer,Y=n(3);function T(e){var t=l(F),n=l(I),i=t([e.cellIndex,e.rowIndex]),o=n([e.cellIndex,e.rowIndex]),r=f()({"app-cell":!0,"snake-cell":i,"food-cell":o});return Object(Y.jsx)("div",{className:r,children:" "})}n(128);var z=c.a.range(0,30).select((function(){return c.a.range(0,30).toArray()})).toArray();function B(){return Object(Y.jsx)("div",{className:"app-field",children:z.map((function(e,t){return function(e,t){return e.map((function(e,n){return Object(Y.jsx)(T,{rowIndex:t,cellIndex:n})}))}(e,t)}))})}var G=n(24),X=(n(129),n(135)),q=n(132),E=function(e){Object(y.a)(n,e);var t=Object(j.a)(n);function n(e){var i;return Object(b.a)(this,n),(i=t.call(this,e)).state={x:null,y:null,direction:null},i.onMouseDown=i.onMouseDown.bind(Object(G.a)(i)),i.onMouseMove=i.onMouseMove.bind(Object(G.a)(i)),i.onMouseUp=i.onMouseUp.bind(Object(G.a)(i)),i}return Object(g.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(X.a)(Object(q.a)(document,"mouseup"),Object(q.a)(document,"touchend")).subscribe((function(t){return e.onMouseUp()})),Object(X.a)(Object(q.a)(document,"mousemove"),Object(q.a)(document,"touchmove")).subscribe((function(t){return e.onMouseMove(t)}))}},{key:"onMouseDown",value:function(e){var t,n,i=null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX,o=null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY;this.setState((function(){return{x:i,y:o}}))}},{key:"onMouseMove",value:function(e){var t,n,i=this.state,o=i.x,r=i.y;if(o&&r){var s=o-(null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX),a=r-(null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY);Math.abs(s)>Math.abs(a)&&s>0?(this.props.onLeftMove(),this.setState((function(){return{direction:"left"}}))):Math.abs(s)>Math.abs(a)&&s<0?(this.props.onRightMove(),this.setState((function(){return{direction:"right"}}))):Math.abs(s)<Math.abs(a)&&a<0?(this.props.onDownMove(),this.setState((function(){return{direction:"down"}}))):Math.abs(s)<Math.abs(a)&&a>0&&(this.props.onUpMove(),this.setState((function(){return{direction:"up"}})))}}},{key:"onMouseUp",value:function(){this.setState((function(){return{x:null,y:null,direction:null}}))}},{key:"render",value:function(){return Object(Y.jsxs)("div",{className:f()("app-controller",this.state.direction),children:[Object(Y.jsx)("div",{className:"app-controller__top arrow control",children:" "}),Object(Y.jsx)("div",{className:"app-controller__right arrow control",children:" "}),Object(Y.jsx)("div",{className:"app-controller__bottom arrow control",children:" "}),Object(Y.jsx)("div",{className:"app-controller__left arrow control",children:" "}),Object(Y.jsx)("div",{className:"app-controller__cursor-placeholder",children:Object(Y.jsx)("div",{className:"app-controller__cursor control",onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,children:" "})})]})}}]),n}(r.a.Component),V=Object(k.b)({name:"game",initialState:{started:!1,speed:null,gameOver:null},reducers:{startGame:function(e){e.started=!0,e.speed=1,e.gameOver=null},changeSpeed:function(e,t){e.speed=t.payload},endGame:function(e,t){e.started=!1,e.speed=null,e.gameOver=t.payload}}}),J=V.actions,K=J.startGame,W=(J.changeSpeed,J.endGame),Q=function(e){return e.game.started},Z=function(e){return e.game.gameOver},ee=V.reducer,te=Object(k.a)({reducer:{field:H,game:ee},middleware:function(e){return e({serializableCheck:!1})}}),ne=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"selectLength",value:function(){return te.getState().field.area.snake.body.length}},{key:"selectSpeed",value:function(){return te.getState().game.speed}},{key:"chooseSpeed",value:function(){return 1+(this.selectLength()/4|0)}}]),e}(),ie=function(){function e(){Object(b.a)(this,e),this.utils=new ne,this.defaultPeriod=750,this.period=null,this.repeater=null}return Object(g.a)(e,[{key:"init",value:function(){te.dispatch(_())}},{key:"run",value:function(){var e,t=this;te.dispatch(K()),this.repeater=new x.Repeater((function(){return t.iteration()}),null!==(e=this.period)&&void 0!==e?e:this.defaultPeriod).start()}},{key:"iteration",value:function(){var e=this.utils.selectSpeed(),t=this.utils.chooseSpeed();e!==t&&this.changeSpeed(t);try{te.dispatch($())}catch(n){n instanceof m&&(te.dispatch(W(n.message)),this.stop())}}},{key:"changeSpeed",value:function(e){this.stop(),this.period=Math.pow(.9,e)*this.defaultPeriod,this.run()}},{key:"stop",value:function(){this.repeater.kill()}}]),e}(),oe=n(136),re=n(133),se=n(134),ae=n(42),ue=function(){function e(){Object(b.a)(this,e),this.moves$=void 0,this.keyPress$=void 0,this.controllerChange$=new oe.a,this.dead$=new oe.a}return Object(g.a)(e,[{key:"init",value:function(){this.keyPress$=this.subscribeToKeys(),this.moves$=Object(X.a)(this.keyPress$,this.controllerChange$).pipe(Object(re.a)((function(e,t){return e===t})),Object(se.a)(this.dead$)),this.moves$.subscribe((function(e){switch(e){case i.Up:te.dispatch(U());break;case i.Down:te.dispatch(L());break;case i.Right:te.dispatch(R());break;case i.Left:te.dispatch(N())}}))}},{key:"subscribeToKeys",value:function(){return Object(q.a)(document,"keydown").pipe(Object(ae.a)((function(e){return e.key})),Object(ae.a)((function(e){switch(e){case"ArrowUp":return i.Up;case"ArrowDown":return i.Down;case"ArrowRight":return i.Right;case"ArrowLeft":return i.Left}})))}},{key:"turnUp",value:function(){this.controllerChange$.next(i.Up)}},{key:"turnRight",value:function(){this.controllerChange$.next(i.Right)}},{key:"turnDown",value:function(){this.controllerChange$.next(i.Down)}},{key:"turnLeft",value:function(){this.controllerChange$.next(i.Left)}},{key:"unsubscribe",value:function(){this.dead$.next(),this.dead$.complete()}}]),e}(),ce=new ie,he=new ue;var le=function(){Object(o.useEffect)((function(){he.init()}));var e=l(Q),t=l(Z);return Object(Y.jsxs)("div",{className:"App",children:[Object(Y.jsx)(B,{}),e?Object(Y.jsx)(E,{onUpMove:function(){return he.turnUp()},onRightMove:function(){return he.turnRight()},onDownMove:function(){return he.turnDown()},onLeftMove:function(){return he.turnLeft()}}):Object(Y.jsx)("button",{className:"start-game",onClick:function(){ce.init(),ce.run()},children:"Start"}),t?Object(Y.jsx)("span",{children:t}):null]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(Y.jsx)(r.a.StrictMode,{children:Object(Y.jsx)(h.a,{store:te,children:Object(Y.jsx)(le,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},67:function(e,t,n){}},[[130,1,2]]]);
//# sourceMappingURL=main.dc772c1a.chunk.js.map
(this.webpackJsonpsnake=this.webpackJsonpsnake||[]).push([[0],{123:function(e,t,n){},124:function(e,t,n){},125:function(e,t,n){"use strict";n.r(t);var o,i=n(0),r=n.n(i),s=n(27),a=n.n(s),u=(n(62),n(11)),c=n.n(u),l=n(24),h=l.c,d=n(29),f=n.n(d),k=n(37),v=n(28),b=n(54),p=n(14),w=n(16);!function(e){e.Up="Up",e.Right="Right",e.Down="Down",e.Left="Left"}(o||(o={}));var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[o.Up];Object(p.a)(this,e),this.body=void 0,this.body=t}return Object(w.a)(e,[{key:"head",get:function(){return c()(this.body).first()}},{key:"last",get:function(){return c()(this.body).last()}},{key:"isVertical",get:function(){return this.head===o.Up||this.head===o.Down}},{key:"isHorizontal",get:function(){return this.head===o.Left||this.head===o.Right}},{key:"up",value:function(){return this.isVertical?this:this.turnSnake(o.Up)}},{key:"right",value:function(){return this.isHorizontal?this:this.turnSnake(o.Right)}},{key:"down",value:function(){return this.isVertical?this:this.turnSnake(o.Down)}},{key:"left",value:function(){return this.isHorizontal?this:this.turnSnake(o.Left)}},{key:"grow",value:function(){return new e(c()(this.body).append(this.last).toArray())}},{key:"move",value:function(){return new e(c()(this.body).skipLast(1).prepend(this.head).toArray())}},{key:"turnSnake",value:function(t){return new e(c()(this.body).skip(1).prepend(t).toArray())}}]),e}(),g=n(30),y=n(38),O=n(55),m=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){return Object(p.a)(this,n),t.call(this,e)}return n}(Object(O.a)(Error)),x=n(32),C=function(){function e(){Object(p.a)(this,e)}return Object(w.a)(e,[{key:"compare",value:function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:e[1]-t[1]}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"getHashCode",value:function(e){return(e[0]+1024)*(e[1]+512)}}]),e}(),M={area:new(function(){function e(t,n,o){var i,r,s;Object(p.a)(this,e),this.height=void 0,this.width=void 0,this.snake=void 0,this.snakeCells=void 0,this.foodCells=void 0,this.snakePosition=void 0,this.rnd=new x.Random,this.height=t,this.width=n,this.snake=null!==(i=null===o||void 0===o?void 0:o.snake)&&void 0!==i?i:new j,this.snakePosition=null!==(r=null===o||void 0===o?void 0:o.snakePosition)&&void 0!==r?r:[t/2|0,n/2|0],this.snakeCells=this.getSnakeCells(),this.foodCells=(null===o||void 0===o||null===(s=o.foodCells)||void 0===s?void 0:s.length)?o.foodCells:[this.generateRandomFreeCell()]}return Object(w.a)(e,[{key:"snakeHeadDirection",get:function(){return this.snake.head}},{key:"snakeTail",get:function(){return c()(this.snakeCells).last()}},{key:"tick",value:function(){var t=this.getNextSnakePosition();if(!this.checkBounds(t))throw new m("You break area beyond");if(this.isSnakeCell(t)&&!(new C).equals(t,this.snakeTail))throw new m("You did eat yourself");var n=this.snake.move();return this.isFoodCell(t)&&(n=n.grow(),this.foodCells=c()(this.foodCells).where((function(e){return!(new C).equals(t,e)})).toArray()),new e(this.height,this.width,{snake:n,snakePosition:t,foodCells:this.foodCells})}},{key:"turnUp",value:function(){return new e(this.height,this.width,{snake:this.snake.up(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnRight",value:function(){return new e(this.height,this.width,{snake:this.snake.right(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnDown",value:function(){return new e(this.height,this.width,{snake:this.snake.down(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnLeft",value:function(){return new e(this.height,this.width,{snake:this.snake.left(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"isSnakeCell",value:function(e){return c()(this.snakeCells).contains(e,new C)}},{key:"isFoodCell",value:function(e){return c()(this.foodCells).contains(e,new C)}},{key:"generateRandomFreeCell",value:function(){var e=null;do{e=[this.rnd.next(this.width),this.rnd.next(this.height)]}while(this.isSnakeCell(e));return e}},{key:"checkBounds",value:function(e){var t=Object(b.a)(e,2),n=t[0],o=t[1];return!(n<0||n>=this.width)&&!(o<0||o>=this.height)}},{key:"getNextSnakePosition",value:function(){var e=this.snakePosition;switch(this.snakeHeadDirection){case o.Up:return[e[0],e[1]-1];case o.Right:return[e[0]+1,e[1]];case o.Down:return[e[0],e[1]+1];case o.Left:return[e[0]-1,e[1]]}}},{key:"getSnakeCells",value:function(){for(var e=[this.snakePosition],t=this.snakePosition,n=1;n<this.snake.body.length;n++)t=this.getNextSectionCoord(t,this.snake.body[n]),e.push(t);return e}},{key:"getNextSectionCoord",value:function(e,t){switch(t){case o.Up:return[e[0],e[1]+1];case o.Right:return[e[0]-1,e[1]];case o.Down:return[e[0],e[1]-1];case o.Left:return[e[0]+1,e[1]]}}}]),e}())(31,31),gameStarted:!1,speed:1},S=Object(k.b)({name:"field",initialState:M,reducers:{turnUp:function(e){e.area=e.area.turnUp()},turnRight:function(e){e.area=e.area.turnRight()},turnDown:function(e){e.area=e.area.turnDown()},turnLeft:function(e){e.area=e.area.turnLeft()},tick:function(e){e.area=e.area.tick()},startGame:function(e){e.gameStarted=!0},changeSpeed:function(e,t){e.speed=t.payload}}}),D=S.actions,U=D.turnUp,R=D.turnRight,L=D.turnDown,P=D.turnLeft,N=D.tick,_=D.startGame,A=function(e){return e.field.area},I=function(e){return e.field.gameStarted},H=Object(v.a)(A,(function(e){return function(t){return e.isSnakeCell(t)}})),Y=Object(v.a)(A,(function(e){return function(t){return e.isFoodCell(t)}})),F=S.reducer,B=n(4);function E(e){var t=h(H),n=h(Y),o=t([e.cellIndex,e.rowIndex]),i=n([e.cellIndex,e.rowIndex]),r=f()({"app-cell":!0,"snake-cell":o,"food-cell":i});return Object(B.jsx)("div",{className:r,children:" "})}n(123);var X=c.a.range(0,30).select((function(){return c.a.range(0,30).toArray()})).toArray();function q(){return Object(B.jsx)("div",{className:"app-field",children:X.map((function(e,t){return function(e,t){return e.map((function(e,n){return Object(B.jsx)(E,{rowIndex:t,cellIndex:n})}))}(e,t)}))})}var z=Object(k.a)({reducer:{field:F}}),T=n(21),V=(n(124),n(128)),G=n(126),J=n(129),W=function(e){Object(g.a)(n,e);var t=Object(y.a)(n);function n(e){var o;return Object(p.a)(this,n),(o=t.call(this,e)).state={x:null,y:null,direction:null},o.onMouseDown=o.onMouseDown.bind(Object(T.a)(o)),o.onMouseMove=o.onMouseMove.bind(Object(T.a)(o)),o.onMouseUp=o.onMouseUp.bind(Object(T.a)(o)),o}return Object(w.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(V.a)(Object(G.a)(document,"mouseup"),Object(G.a)(document,"touchend")).subscribe((function(t){return e.onMouseUp()})),Object(V.a)(Object(G.a)(document,"mousemove"),Object(G.a)(document,"touchmove")).pipe(Object(J.a)(100)).subscribe((function(t){return e.onMouseMove(t)}))}},{key:"onMouseDown",value:function(e){var t,n,o=null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX,i=null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY;this.setState((function(){return{x:o,y:i}}))}},{key:"onMouseMove",value:function(e){var t,n,o=this.state,i=o.x,r=o.y;if(i&&r){var s=i-(null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX),a=r-(null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY);Math.abs(s)>Math.abs(a)&&s>0?(this.props.onLeftMove(),this.setState((function(){return{direction:"left"}}))):Math.abs(s)>Math.abs(a)&&s<0?(this.props.onRightMove(),this.setState((function(){return{direction:"right"}}))):Math.abs(s)<Math.abs(a)&&a<0?(this.props.onDownMove(),this.setState((function(){return{direction:"down"}}))):Math.abs(s)<Math.abs(a)&&a>0&&(this.props.onUpMove(),this.setState((function(){return{direction:"up"}})))}}},{key:"onMouseUp",value:function(){this.setState((function(){return{x:null,y:null,direction:null}}))}},{key:"render",value:function(){return Object(B.jsxs)("div",{className:f()("app-controller",this.state.direction),children:[Object(B.jsx)("div",{className:"app-controller__top arrow control",children:" "}),Object(B.jsx)("div",{className:"app-controller__right arrow control",children:" "}),Object(B.jsx)("div",{className:"app-controller__bottom arrow control",children:" "}),Object(B.jsx)("div",{className:"app-controller__left arrow control",children:" "}),Object(B.jsx)("div",{className:"app-controller__cursor-placeholder",children:Object(B.jsx)("div",{className:"app-controller__cursor control",onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,children:" "})})]})}}]),n}(r.a.Component),$=n(130),K=n(36),Q=n(127),Z=750;function ee(){return z.getState().field.speed}function te(){return 1+(z.getState().field.area.snake.body.length/4|0)}var ne=null;function oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z;return e?(ne=new x.Repeater((function(){var t=ee(),n=te();t!==n&&(ne.kill(),oe(e,Math.pow(.9,n)*Z)),z.dispatch(N())}),t).start(),function(){return ne.kill()}):function(){}}var ie=Object(G.a)(document,"keydown").pipe(Object(J.a)(100),Object(K.a)((function(e){return e.key})),Object(K.a)((function(e){switch(e){case"ArrowUp":return o.Up;case"ArrowDown":return o.Down;case"ArrowRight":return o.Right;case"ArrowLeft":return o.Left}}))),re=new $.a,se=Object(V.a)(ie,re).pipe(Object(Q.a)((function(e,t){return e===t})));var ae=function(){Object(i.useEffect)((function(){se.subscribe((function(e){switch(e){case o.Up:z.dispatch(U());break;case o.Down:z.dispatch(L());break;case o.Right:z.dispatch(R());break;case o.Left:z.dispatch(P())}}))}));var e=h(I),t=Object(l.b)();return Object(i.useEffect)((function(){return oe(e)})),Object(B.jsxs)("div",{className:"App",children:[Object(B.jsx)(q,{}),e?Object(B.jsx)(W,{onDownMove:function(){return re.next(o.Down)},onLeftMove:function(){return re.next(o.Left)},onUpMove:function(){return re.next(o.Up)},onRightMove:function(){return re.next(o.Right)}}):Object(B.jsx)("button",{className:"start-game",onClick:function(){return t(_())},children:"Start"})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(B.jsx)(r.a.StrictMode,{children:Object(B.jsx)(l.a,{store:z,children:Object(B.jsx)(ae,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},62:function(e,t,n){}},[[125,1,2]]]);
//# sourceMappingURL=main.5f4147d4.chunk.js.map
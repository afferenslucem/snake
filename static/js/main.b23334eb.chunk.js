(this.webpackJsonpsnake=this.webpackJsonpsnake||[]).push([[0],{128:function(e,t,n){},129:function(e,t,n){},130:function(e,t,n){"use strict";n.r(t);var i,s=n(0),o=n.n(s),r=n(30),a=n.n(r),c=(n(67),n(14)),u=n.n(c),l=n(27),h=l.c,d=n(32),f=n.n(d),v=n(18),k=n(31),p=n(60),b=n(10),g=n(12);!function(e){e.Up="Up",e.Right="Right",e.Down="Down",e.Left="Left"}(i||(i={}));var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[i.Up],n=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0;Object(b.a)(this,e),this.body=void 0,this.nextDirection=void 0,this.previousTail=void 0,this.body=t,this.nextDirection=n||this.headDirection,this.previousTail=1===this.body.length?this.headDirection:s}return Object(g.a)(e,[{key:"headDirection",get:function(){return u()(this.body).first()}},{key:"tailDirection",get:function(){return u()(this.body).last()}},{key:"length",get:function(){return this.body.length}},{key:"isVertical",get:function(){return this.headDirection===i.Up||this.headDirection===i.Down}},{key:"isHorizontal",get:function(){return this.headDirection===i.Left||this.headDirection===i.Right}},{key:"up",value:function(){return this.isVertical&&this.length>1?this:this.turnSnake(i.Up)}},{key:"right",value:function(){return this.isHorizontal&&this.length>1?this:this.turnSnake(i.Right)}},{key:"down",value:function(){return this.isVertical&&this.length>1?this:this.turnSnake(i.Down)}},{key:"left",value:function(){return this.isHorizontal&&this.length>1?this:this.turnSnake(i.Left)}},{key:"grow",value:function(){return new e(u()(this.body).append(this.previousTail).toArray(),null,this.previousTail)}},{key:"move",value:function(){var t=this.turnHead();return new e(this.makeStep(t).toArray(),void 0,this.tailDirection)}},{key:"turnHead",value:function(){return u()(this.body).skip(1).prepend(this.nextDirection)}},{key:"makeStep",value:function(e){return e.skipLast(1).prepend(this.nextDirection)}},{key:"turnSnake",value:function(t){return new e(this.body,t,this.previousTail)}}]),e}(),w=n(33),y=n(44),O=n(61),m=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(e){return Object(b.a)(this,n),t.call(this,e)}return n}(Object(O.a)(Error)),x=n(35),S=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"compare",value:function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:e[1]-t[1]}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"getHashCode",value:function(e){return(e[0]+1024)*(e[1]+512)}}]),e}(),C=function(){function e(t,n,i){var s,o,r;Object(b.a)(this,e),this.height=void 0,this.width=void 0,this.snake=void 0,this.snakeCells=void 0,this.foodCells=void 0,this.snakePosition=void 0,this.rnd=new x.Random,this.height=t,this.width=n,this.snake=null!==(s=null===i||void 0===i?void 0:i.snake)&&void 0!==s?s:new j,this.snakePosition=null!==(o=null===i||void 0===i?void 0:i.snakePosition)&&void 0!==o?o:[t/2|0,n/2|0],this.snakeCells=this.getSnakeCells(),this.foodCells=(null===i||void 0===i||null===(r=i.foodCells)||void 0===r?void 0:r.length)?i.foodCells:[this.generateRandomFreeCell()]}return Object(g.a)(e,[{key:"snakeNextDirection",get:function(){return this.snake.nextDirection}},{key:"snakeTail",get:function(){return u()(this.snakeCells).last()}},{key:"tick",value:function(){var t=this.getNextSnakePosition();if(!this.checkBounds(t))throw new m("You break area beyond");if(this.isSnakeCell(t)&&!(new S).equals(t,this.snakeTail))throw new m("You did eat yourself");var n=this.snake;return n=n.move(),this.isFoodCell(t)&&(n=n.grow(),this.foodCells=u()(this.foodCells).where((function(e){return!(new S).equals(t,e)})).toArray()),new e(this.height,this.width,{snake:n,snakePosition:t,foodCells:this.foodCells})}},{key:"turnUp",value:function(){return new e(this.height,this.width,{snake:this.snake.up(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnRight",value:function(){return new e(this.height,this.width,{snake:this.snake.right(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnDown",value:function(){return new e(this.height,this.width,{snake:this.snake.down(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnLeft",value:function(){return new e(this.height,this.width,{snake:this.snake.left(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"isSnakeCell",value:function(e){return u()(this.snakeCells).contains(e,new S)}},{key:"isFoodCell",value:function(e){return u()(this.foodCells).contains(e,new S)}},{key:"generateRandomFreeCell",value:function(){var e=null;do{e=[this.rnd.next(this.width),this.rnd.next(this.height)]}while(this.isSnakeCell(e));return e}},{key:"checkBounds",value:function(e){var t=Object(p.a)(e,2),n=t[0],i=t[1];return!(n<0||n>=this.width)&&!(i<0||i>=this.height)}},{key:"getNextSnakePosition",value:function(){var e=this.snakePosition;switch(this.snakeNextDirection){case i.Up:return[e[0],e[1]-1];case i.Right:return[e[0]+1,e[1]];case i.Down:return[e[0],e[1]+1];case i.Left:return[e[0]-1,e[1]]}}},{key:"getSnakeCells",value:function(){for(var e=[this.snakePosition],t=this.snakePosition,n=1;n<this.snake.body.length;n++)t=this.getNextSectionCoord(t,this.snake.body[n]),e.push(t);return e}},{key:"getNextSectionCoord",value:function(e,t){switch(t){case i.Up:return[e[0],e[1]+1];case i.Right:return[e[0]-1,e[1]];case i.Down:return[e[0],e[1]-1];case i.Left:return[e[0]+1,e[1]]}}}]),e}(),D={area:new C(31,31)},M=Object(v.b)({name:"field",initialState:D,reducers:{turnUp:function(e){e.area=e.area.turnUp()},turnRight:function(e){e.area=e.area.turnRight()},turnDown:function(e){e.area=e.area.turnDown()},turnLeft:function(e){e.area=e.area.turnLeft()},tickField:function(e){e.area=e.area.tick()},initField:function(e){e.area=new C(31,31)}}}),L=M.actions,N=L.turnUp,_=L.turnRight,P=L.turnDown,U=L.turnLeft,R=L.tickField,$=L.initField,A=function(e){return e.field.area},T=Object(k.a)(A,(function(e){return function(t){return e.isSnakeCell(t)}})),F=Object(k.a)(A,(function(e){return e.snake.body.length})),I=Object(k.a)(A,(function(e){return function(t){return e.isFoodCell(t)}})),G=M.reducer,H=n(1);function Y(e){var t=h(T),n=h(I),i=t([e.cellIndex,e.rowIndex]),s=n([e.cellIndex,e.rowIndex]),o=f()({"app-cell":!0,"snake-cell":i,"food-cell":s});return Object(H.jsx)("div",{className:o,children:" "})}n(128);var z=u.a.range(0,30).select((function(){return u.a.range(0,30).toArray()})).toArray();function B(){return Object(H.jsx)("div",{className:"app-field",children:z.map((function(e,t){return function(e,t){return e.map((function(e,n){return Object(H.jsx)(Y,{rowIndex:t,cellIndex:n})}))}(e,t)}))})}var X=n(24),q=(n(129),n(135)),E=n(132),V=function(e){Object(w.a)(n,e);var t=Object(y.a)(n);function n(e){var i;return Object(b.a)(this,n),(i=t.call(this,e)).state={x:null,y:null,direction:null},i.onMouseDown=i.onMouseDown.bind(Object(X.a)(i)),i.onMouseMove=i.onMouseMove.bind(Object(X.a)(i)),i.onMouseUp=i.onMouseUp.bind(Object(X.a)(i)),i}return Object(g.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(q.a)(Object(E.a)(document,"mouseup"),Object(E.a)(document,"touchend")).subscribe((function(t){return e.onMouseUp()})),Object(q.a)(Object(E.a)(document,"mousemove"),Object(E.a)(document,"touchmove")).subscribe((function(t){return e.onMouseMove(t)}))}},{key:"onMouseDown",value:function(e){var t,n,i=null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX,s=null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY;this.setState((function(){return{x:i,y:s}}))}},{key:"onMouseMove",value:function(e){var t,n,i=this.state,s=i.x,o=i.y;if(s&&o){var r=s-(null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX),a=o-(null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY);Math.abs(r)>Math.abs(a)&&r>0?(this.props.onLeftMove(),this.setState((function(){return{direction:"left"}}))):Math.abs(r)>Math.abs(a)&&r<0?(this.props.onRightMove(),this.setState((function(){return{direction:"right"}}))):Math.abs(r)<Math.abs(a)&&a<0?(this.props.onDownMove(),this.setState((function(){return{direction:"down"}}))):Math.abs(r)<Math.abs(a)&&a>0&&(this.props.onUpMove(),this.setState((function(){return{direction:"up"}})))}}},{key:"onMouseUp",value:function(){this.setState((function(){return{x:null,y:null,direction:null}}))}},{key:"render",value:function(){return Object(H.jsxs)("div",{className:f()("app-controller",this.state.direction),children:[Object(H.jsx)("div",{className:"app-controller__top arrow control",children:" "}),Object(H.jsx)("div",{className:"app-controller__right arrow control",children:" "}),Object(H.jsx)("div",{className:"app-controller__bottom arrow control",children:" "}),Object(H.jsx)("div",{className:"app-controller__left arrow control",children:" "}),Object(H.jsx)("div",{className:"app-controller__cursor-placeholder",children:Object(H.jsx)("div",{className:"app-controller__cursor control",onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,children:" "})})]})}}]),n}(o.a.Component),J=Object(v.b)({name:"game",initialState:{started:!1,speed:null,gameOver:null},reducers:{startGame:function(e){e.started=!0,e.speed=1,e.gameOver=null},changeSpeed:function(e,t){e.speed=t.payload},endGame:function(e,t){e.started=!1,e.speed=null,e.gameOver=t.payload}}}),K=J.actions,W=K.startGame,Q=K.changeSpeed,Z=K.endGame,ee=function(e){return e.game.started},te=function(e){return e.game.gameOver},ne=function(e){return e.game.speed},ie=J.reducer,se=Object(v.b)({name:"score",initialState:{score:0},reducers:{addScore:function(e,t){e.score+=t.payload},resetScore:function(e){e.score=0}}}),oe=se.actions,re=oe.addScore,ae=oe.resetScore,ce=function(e){return e.score.score},ue=se.reducer,le=Object(v.a)({reducer:{field:G,game:ie,score:ue},middleware:function(e){return e({serializableCheck:!1})}}),he=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"getAdditionalScore",value:function(e){return 10*e}}]),e}(),de=function(){function e(){Object(b.a)(this,e)}return Object(g.a)(e,[{key:"selectLength",value:function(){return le.getState().field.area.snake.body.length}},{key:"selectSpeed",value:function(){return le.getState().game.speed}},{key:"chooseSpeed",value:function(){return 1+(this.selectLength()/4|0)}}]),e}(),fe=function(){function e(){Object(b.a)(this,e),this.utils=new de,this.defaultPeriod=750,this.period=null,this.repeater=null,this.previousLength=null}return Object(g.a)(e,[{key:"init",value:function(){le.dispatch($()),le.dispatch(ae()),this.previousLength=this.utils.selectLength()}},{key:"run",value:function(){var e,t=this;this.repeater=new x.Repeater((function(){return t.iteration()}),null!==(e=this.period)&&void 0!==e?e:this.defaultPeriod).start()}},{key:"startGame",value:function(){le.dispatch(W()),this.run()}},{key:"iteration",value:function(){var e=this.utils.selectSpeed(),t=this.utils.chooseSpeed(),n=this.utils.selectLength();this.previousLength!==n&&this.changeScore(e),e!==t&&this.changeSpeed(t),this.previousLength=n;try{le.dispatch(R())}catch(i){i instanceof m&&(le.dispatch(Z(i.message)),this.stop(),this.init())}}},{key:"changeScore",value:function(e){var t=(new he).getAdditionalScore(e);le.dispatch(re(t))}},{key:"changeSpeed",value:function(e){this.stop(),this.period=Math.pow(.9,e)*this.defaultPeriod,le.dispatch(Q(e)),this.run()}},{key:"stop",value:function(){this.repeater.kill()}}]),e}(),ve=n(136),ke=n(133),pe=n(134),be=n(42),ge=function(){function e(){Object(b.a)(this,e),this.moves$=void 0,this.keyPress$=void 0,this.controllerChange$=new ve.a,this.dead$=new ve.a}return Object(g.a)(e,[{key:"init",value:function(){this.keyPress$=this.subscribeToKeys(),this.moves$=Object(q.a)(this.keyPress$,this.controllerChange$).pipe(Object(ke.a)((function(e,t){return e===t})),Object(pe.a)(this.dead$)),this.moves$.subscribe((function(e){switch(e){case i.Up:le.dispatch(N());break;case i.Down:le.dispatch(P());break;case i.Right:le.dispatch(_());break;case i.Left:le.dispatch(U())}}))}},{key:"subscribeToKeys",value:function(){return Object(E.a)(document,"keydown").pipe(Object(be.a)((function(e){return e.key})),Object(be.a)((function(e){switch(e){case"ArrowUp":return i.Up;case"ArrowDown":return i.Down;case"ArrowRight":return i.Right;case"ArrowLeft":return i.Left}})))}},{key:"turnUp",value:function(){this.controllerChange$.next(i.Up)}},{key:"turnRight",value:function(){this.controllerChange$.next(i.Right)}},{key:"turnDown",value:function(){this.controllerChange$.next(i.Down)}},{key:"turnLeft",value:function(){this.controllerChange$.next(i.Left)}},{key:"unsubscribe",value:function(){this.dead$.next(),this.dead$.complete()}}]),e}();function je(){var e=h(ce),t=h(F),n=h(ne);return Object(H.jsxs)("div",{className:"app-score",children:[Object(H.jsxs)("div",{className:"score-info",children:[Object(H.jsx)("label",{className:"score-info__header",children:"Score"}),Object(H.jsx)("div",{className:"score-info__value",children:e})]}),Object(H.jsxs)("div",{className:"snake-speed-info",children:[Object(H.jsx)("label",{className:"snake-speed-info__header",children:"Speed"}),Object(H.jsx)("div",{className:"snake-speed-info__value",children:n})]}),Object(H.jsxs)("div",{className:"snake-length-info",children:[Object(H.jsx)("label",{className:"snake-length-info__header",children:"Length"}),Object(H.jsx)("div",{className:"snake-length-info__value",children:t})]})]})}var we=new fe,ye=new ge;var Oe=function(){Object(s.useEffect)((function(){ye.init()}));var e=h(ee),t=h(te);return Object(H.jsxs)("div",{className:"App",children:[Object(H.jsxs)("div",{className:"app-game-place",children:[Object(H.jsx)(B,{}),e?Object(H.jsx)(je,{}):null]}),e?Object(H.jsx)(V,{onUpMove:function(){return ye.turnUp()},onRightMove:function(){return ye.turnRight()},onDownMove:function(){return ye.turnDown()},onLeftMove:function(){return ye.turnLeft()}}):Object(H.jsx)("button",{className:"start-game",onClick:function(){we.startGame()},children:"Start"}),t?Object(H.jsx)("span",{children:t}):null]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(H.jsx)(o.a.StrictMode,{children:Object(H.jsx)(l.a,{store:le,children:Object(H.jsx)(Oe,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},67:function(e,t,n){}},[[130,1,2]]]);
//# sourceMappingURL=main.b23334eb.chunk.js.map
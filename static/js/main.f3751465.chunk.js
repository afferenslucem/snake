(this.webpackJsonpsnake=this.webpackJsonpsnake||[]).push([[0],{122:function(e,t,n){},123:function(e,t,n){},124:function(e,t,n){"use strict";n.r(t);var i,o=n(0),s=n.n(o),r=n(28),a=n.n(r),u=(n(61),n(11)),c=n.n(u),l=n(25),h=l.c,d=n(30),f=n.n(d),k=n(21),v=n(29),p=n(54),b=n(13),w=n(15);!function(e){e.Up="Up",e.Right="Right",e.Down="Down",e.Left="Left"}(i||(i={}));var g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[i.Up];Object(b.a)(this,e),this.body=void 0,this.body=t}return Object(w.a)(e,[{key:"head",get:function(){return c()(this.body).first()}},{key:"last",get:function(){return c()(this.body).last()}},{key:"isVertical",get:function(){return this.head===i.Up||this.head===i.Down}},{key:"isHorizontal",get:function(){return this.head===i.Left||this.head===i.Right}},{key:"up",value:function(){return this.isVertical?this:this.turnSnake(i.Up)}},{key:"right",value:function(){return this.isHorizontal?this:this.turnSnake(i.Right)}},{key:"down",value:function(){return this.isVertical?this:this.turnSnake(i.Down)}},{key:"left",value:function(){return this.isHorizontal?this:this.turnSnake(i.Left)}},{key:"grow",value:function(){return new e(c()(this.body).append(this.last).toArray())}},{key:"move",value:function(){return new e(c()(this.body).skipLast(1).prepend(this.head).toArray())}},{key:"turnSnake",value:function(t){return new e(c()(this.body).skip(1).prepend(t).toArray())}}]),e}(),j=n(31),y=n(38),O=n(55),m=function(e){Object(j.a)(n,e);var t=Object(y.a)(n);function n(e){return Object(b.a)(this,n),t.call(this,e)}return n}(Object(O.a)(Error)),x=n(33),C=function(){function e(){Object(b.a)(this,e)}return Object(w.a)(e,[{key:"compare",value:function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:e[1]-t[1]}},{key:"equals",value:function(e,t){return e[0]===t[0]&&e[1]===t[1]}},{key:"getHashCode",value:function(e){return(e[0]+1024)*(e[1]+512)}}]),e}(),M=function(){function e(t,n,i){var o,s,r;Object(b.a)(this,e),this.height=void 0,this.width=void 0,this.snake=void 0,this.snakeCells=void 0,this.foodCells=void 0,this.snakePosition=void 0,this.rnd=new x.Random,this.height=t,this.width=n,this.snake=null!==(o=null===i||void 0===i?void 0:i.snake)&&void 0!==o?o:new g,this.snakePosition=null!==(s=null===i||void 0===i?void 0:i.snakePosition)&&void 0!==s?s:[t/2|0,n/2|0],this.snakeCells=this.getSnakeCells(),this.foodCells=(null===i||void 0===i||null===(r=i.foodCells)||void 0===r?void 0:r.length)?i.foodCells:[this.generateRandomFreeCell()]}return Object(w.a)(e,[{key:"snakeHeadDirection",get:function(){return this.snake.head}},{key:"snakeTail",get:function(){return c()(this.snakeCells).last()}},{key:"tick",value:function(){var t=this.getNextSnakePosition();if(!this.checkBounds(t))throw new m("You break area beyond");if(this.isSnakeCell(t)&&!(new C).equals(t,this.snakeTail))throw new m("You did eat yourself");var n=this.snake.move();return this.isFoodCell(t)&&(n=n.grow(),this.foodCells=c()(this.foodCells).where((function(e){return!(new C).equals(t,e)})).toArray()),new e(this.height,this.width,{snake:n,snakePosition:t,foodCells:this.foodCells})}},{key:"turnUp",value:function(){return new e(this.height,this.width,{snake:this.snake.up(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnRight",value:function(){return new e(this.height,this.width,{snake:this.snake.right(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnDown",value:function(){return new e(this.height,this.width,{snake:this.snake.down(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"turnLeft",value:function(){return new e(this.height,this.width,{snake:this.snake.left(),snakePosition:this.snakePosition,foodCells:this.foodCells})}},{key:"isSnakeCell",value:function(e){return c()(this.snakeCells).contains(e,new C)}},{key:"isFoodCell",value:function(e){return c()(this.foodCells).contains(e,new C)}},{key:"generateRandomFreeCell",value:function(){var e=null;do{e=[this.rnd.next(this.width),this.rnd.next(this.height)]}while(this.isSnakeCell(e));return e}},{key:"checkBounds",value:function(e){var t=Object(p.a)(e,2),n=t[0],i=t[1];return!(n<0||n>=this.width)&&!(i<0||i>=this.height)}},{key:"getNextSnakePosition",value:function(){var e=this.snakePosition;switch(this.snakeHeadDirection){case i.Up:return[e[0],e[1]-1];case i.Right:return[e[0]+1,e[1]];case i.Down:return[e[0],e[1]+1];case i.Left:return[e[0]-1,e[1]]}}},{key:"getSnakeCells",value:function(){for(var e=[this.snakePosition],t=this.snakePosition,n=1;n<this.snake.body.length;n++)t=this.getNextSectionCoord(t,this.snake.body[n]),e.push(t);return e}},{key:"getNextSectionCoord",value:function(e,t){switch(t){case i.Up:return[e[0],e[1]+1];case i.Right:return[e[0]-1,e[1]];case i.Down:return[e[0],e[1]-1];case i.Left:return[e[0]+1,e[1]]}}}]),e}(),S={area:new M(31,31)},D=Object(k.b)({name:"field",initialState:S,reducers:{turnUp:function(e){e.area=e.area.turnUp()},turnRight:function(e){e.area=e.area.turnRight()},turnDown:function(e){e.area=e.area.turnDown()},turnLeft:function(e){e.area=e.area.turnLeft()},tickField:function(e){e.area=e.area.tick()},initField:function(e){e.area=new M(31,31)}}}),U=D.actions,P=U.turnUp,R=U.turnRight,L=U.turnDown,N=U.turnLeft,_=U.tickField,A=U.initField,F=function(e){return e.field.area},I=Object(v.a)(F,(function(e){return function(t){return e.isSnakeCell(t)}})),H=Object(v.a)(F,(function(e){return function(t){return e.isFoodCell(t)}})),Y=D.reducer,z=n(4);function B(e){var t=h(I),n=h(H),i=t([e.cellIndex,e.rowIndex]),o=n([e.cellIndex,e.rowIndex]),s=f()({"app-cell":!0,"snake-cell":i,"food-cell":o});return Object(z.jsx)("div",{className:s,children:" "})}n(122);var G=c.a.range(0,30).select((function(){return c.a.range(0,30).toArray()})).toArray();function X(){return Object(z.jsx)("div",{className:"app-field",children:G.map((function(e,t){return function(e,t){return e.map((function(e,n){return Object(z.jsx)(B,{rowIndex:t,cellIndex:n})}))}(e,t)}))})}var q=Object(k.b)({name:"game",initialState:{started:!1,speed:null,gameOver:null},reducers:{startGame:function(e){e.started=!0,e.speed=1,e.gameOver=null},changeSpeed:function(e,t){e.speed=t.payload},endGame:function(e,t){e.started=!1,e.speed=null,e.gameOver=t.payload}}}),E=q.actions,T=E.startGame,V=(E.changeSpeed,E.endGame),J=function(e){return e.game.started},W=function(e){return e.game.gameOver},$=q.reducer,K=Object(k.a)({reducer:{field:Y,game:$},middleware:function(e){return e({serializableCheck:!1})}}),Q=n(22),Z=(n(123),n(128)),ee=n(126),te=function(e){Object(j.a)(n,e);var t=Object(y.a)(n);function n(e){var i;return Object(b.a)(this,n),(i=t.call(this,e)).state={x:null,y:null,direction:null},i.onMouseDown=i.onMouseDown.bind(Object(Q.a)(i)),i.onMouseMove=i.onMouseMove.bind(Object(Q.a)(i)),i.onMouseUp=i.onMouseUp.bind(Object(Q.a)(i)),i}return Object(w.a)(n,[{key:"componentDidMount",value:function(){var e=this;Object(Z.a)(Object(ee.a)(document,"mouseup"),Object(ee.a)(document,"touchend")).subscribe((function(t){return e.onMouseUp()})),Object(Z.a)(Object(ee.a)(document,"mousemove"),Object(ee.a)(document,"touchmove")).subscribe((function(t){return e.onMouseMove(t)}))}},{key:"onMouseDown",value:function(e){var t,n,i=null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX,o=null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY;this.setState((function(){return{x:i,y:o}}))}},{key:"onMouseMove",value:function(e){var t,n,i=this.state,o=i.x,s=i.y;if(o&&s){var r=o-(null!==(t=e.screenX)&&void 0!==t?t:e.touches[0].screenX),a=s-(null!==(n=e.screenY)&&void 0!==n?n:e.touches[0].screenY);Math.abs(r)>Math.abs(a)&&r>0?(this.props.onLeftMove(),this.setState((function(){return{direction:"left"}}))):Math.abs(r)>Math.abs(a)&&r<0?(this.props.onRightMove(),this.setState((function(){return{direction:"right"}}))):Math.abs(r)<Math.abs(a)&&a<0?(this.props.onDownMove(),this.setState((function(){return{direction:"down"}}))):Math.abs(r)<Math.abs(a)&&a>0&&(this.props.onUpMove(),this.setState((function(){return{direction:"up"}})))}}},{key:"onMouseUp",value:function(){this.setState((function(){return{x:null,y:null,direction:null}}))}},{key:"render",value:function(){return Object(z.jsxs)("div",{className:f()("app-controller",this.state.direction),children:[Object(z.jsx)("div",{className:"app-controller__top arrow control",children:" "}),Object(z.jsx)("div",{className:"app-controller__right arrow control",children:" "}),Object(z.jsx)("div",{className:"app-controller__bottom arrow control",children:" "}),Object(z.jsx)("div",{className:"app-controller__left arrow control",children:" "}),Object(z.jsx)("div",{className:"app-controller__cursor-placeholder",children:Object(z.jsx)("div",{className:"app-controller__cursor control",onMouseDown:this.onMouseDown,onTouchStart:this.onMouseDown,children:" "})})]})}}]),n}(s.a.Component),ne=n(130),ie=n(129),oe=n(37),se=n(127),re=function(){function e(){Object(b.a)(this,e)}return Object(w.a)(e,[{key:"selectLength",value:function(){return K.getState().field.area.snake.body.length}},{key:"selectSpeed",value:function(){return K.getState().game.speed}},{key:"chooseSpeed",value:function(){return 1+(this.selectLength()/4|0)}}]),e}(),ae=new(function(){function e(){Object(b.a)(this,e),this.utils=new re,this.defaultPeriod=750,this.period=null,this.repeater=null}return Object(w.a)(e,[{key:"init",value:function(){K.dispatch(A())}},{key:"run",value:function(){var e,t=this;K.dispatch(T()),this.repeater=new x.Repeater((function(){return t.iteration()}),null!==(e=this.period)&&void 0!==e?e:this.defaultPeriod).start()}},{key:"iteration",value:function(){var e=this.utils.selectSpeed(),t=this.utils.chooseSpeed();e!==t&&this.changeSpeed(t);try{K.dispatch(_())}catch(n){n instanceof m&&(K.dispatch(V(n.message)),this.stop())}}},{key:"changeSpeed",value:function(e){this.stop(),this.period=Math.pow(.9,e)*this.defaultPeriod,this.run()}},{key:"stop",value:function(){this.repeater.kill()}}]),e}()),ue=Object(ee.a)(document,"keydown").pipe(Object(ie.a)(100),Object(oe.a)((function(e){return e.key})),Object(oe.a)((function(e){switch(e){case"ArrowUp":return i.Up;case"ArrowDown":return i.Down;case"ArrowRight":return i.Right;case"ArrowLeft":return i.Left}}))),ce=new ne.a,le=Object(Z.a)(ue,ce).pipe(Object(se.a)((function(e,t){return e===t})));var he=function(){Object(o.useEffect)((function(){le.subscribe((function(e){switch(e){case i.Up:K.dispatch(P());break;case i.Down:K.dispatch(L());break;case i.Right:K.dispatch(R());break;case i.Left:K.dispatch(N())}}))}));var e=h(J),t=h(W);return Object(z.jsxs)("div",{className:"App",children:[Object(z.jsx)(X,{}),e?Object(z.jsx)(te,{onDownMove:function(){return ce.next(i.Down)},onLeftMove:function(){return ce.next(i.Left)},onUpMove:function(){return ce.next(i.Up)},onRightMove:function(){return ce.next(i.Right)}}):Object(z.jsx)("button",{className:"start-game",onClick:function(){ae.init(),ae.run()},children:"Start"}),t?Object(z.jsx)("span",{children:t}):null]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(z.jsx)(s.a.StrictMode,{children:Object(z.jsx)(l.a,{store:K,children:Object(z.jsx)(he,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},61:function(e,t,n){}},[[124,1,2]]]);
//# sourceMappingURL=main.f3751465.chunk.js.map